var __baseWords={defaultError:"サーバーエラーです。\n時間をおいてから再度お試しください。",notEnoughError:"が足りません",dbError:"データベースエラーです。\n時間をおいてから再度お試しください。",requestError:"リクエストエラーです。\n時間をおいてから再度お試しください。",closeGame:"このゲームはすでに終了しています。",confirmFront:"を消費してガチャを",confirmBack:"回引きます。\nよろしいですか？",ticketName:"ガチャ券"};function genTextStyle(){return{fontSize:15,fill:"#fff",stroke:"#000",strokeThickness:5,align:"center"}}function genConfirmText(){var t="ticket"==__data.curGachaInfo.type?__data.curGachaInfo.ticket:__data.curGachaInfo.payDiamond;return __data.curGachaInfo.name+t+__data.curGachaInfo.numeral+__baseWords.confirmFront+__data.curGachaInfo.playGachaCount+__baseWords.confirmBack}function error(t,i){var a=__baseWords.defaultError;switch(i=i.toString()){case"-5":a=__data.curGachaInfo.name+__baseWords.notEnoughError;break;case"-7":a=__baseWords.dbError;break;case"-8":a=__baseWords.requestError;break;case"-10":default:a=__baseWords.closeGame}var e=genTextStyle();e.fontSize=24,t.add.text(t.world.centerX,t.world.centerY,a,e).anchor.setTo(.5);var n=t.add.button(t.world.centerX,.8*t.world.height,"back_btn_off",t.back,t);n.imgOn="back_btn_on",n.imgOff="back_btn_off",n.anchor.setTo(.5),t.setOnOffImg(n)}BasicGame={Boot:function(){}},BasicGame.Boot.prototype={init:function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.stage.backgroundColor="#424242",this.load.crossOrigin="Anonymous"},preload:function(){this.load.atlasJSONHash("loading","//ap-statics.loas.jp/mm2/official/images/minigame/loading.png",null,this.loadingJson())},create:function(){this.state.start("Preloader")},loadingJson:function(){return{frames:{"loading0.png":{frame:{x:0,y:0,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"loading1.png":{frame:{x:512,y:0,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"loading2.png":{frame:{x:1024,y:0,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"loading3.png":{frame:{x:0,y:512,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"loading4.png":{frame:{x:512,y:512,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"loading5.png":{frame:{x:1024,y:512,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"loading6.png":{frame:{x:0,y:1024,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"loading7.png":{frame:{x:512,y:1024,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}}},meta:{app:"https://github.com/piskelapp/piskel/",version:"1.0",image:"loading.png",format:"RGBA8888",size:{w:1536,h:1536}}}}},BasicGame.Preloader=function(){},BasicGame.Preloader.prototype={create:function(){this.loadingAnim(),this.loadAssets(),this.loadProgress(),this.load.onLoadComplete.add(this.loadedAssets,this),this.load.start()},loadProgress:function(){var t=genTextStyle();t.fontSize=24;var i=this.add.text(this.world.centerX,.8*this.world.height,"0%",t);i.anchor.setTo(.5),this.load.onFileComplete.add(function(t){this.setText(t+"%")},i)},loadingAnim:function(){var t=this.add.sprite(this.world.width/2,this.world.height/2,"loading");t.anchor.setTo(.5,.5),t.scale.setTo(.5),t.animations.add("loading").play(8,!0)},loadAssets:function(){var t="//ap-statics.loas.jp/mm2/official/images/minigame/gacha/",i={caution1:"caution1.png",caption1:"caption1.png",caption2:"caption2.png",caption3:"caption3.png",ok_btn:"ok_btn.png",cancel_btn:"cancel_btn.png",detail_btn:"detail_btn.png",play1_btn_on:"play1_btn_on.png",play1_btn_off:"play1_btn_off.png",free_btn_on:"free_btn_on.png",free_btn_off:"free_btn_off.png",gacha_btn_1_off:"gacha_btn_1_off.png",gacha_btn_1_on:"gacha_btn_1_on.png",gacha_btn_2_off:"gacha_btn_2_off.png",gacha_btn_2_on:"gacha_btn_2_on.png",play10_btn_on:"play10_btn_on.png",play10_btn_off:"play10_btn_off.png",play_blue_dia_10_btn_on:"play_blue_dia_10_btn_on.png",play_blue_dia_10_btn_off:"play_blue_dia_10_btn_off.png",back_btn_on:"back_btn_on.png",back_btn_off:"back_btn_off.png",again_btn_on:"again_btn_on.png",again_btn_off:"again_btn_off.png",sword1:"sword1.png",sword2:"sword2.png",sword3:"sword3.png",gr_char_1:"gr_char_1.jpg",gr_char_2:"gr_char_2.jpg",gr_char_3:"gr_char_3.jpg",gr_char_4:"gr_char_4.jpg",gr_char_5:"gr_char_5.jpg",gr_char_6:"gr_char_6.jpg",gr_char_7:"gr_char_7.jpg",gr_char_7_2:"gr_char_7_2.png",gr_char_8:"gr_char_8.jpg",char_anim1:"char_anim1.png",char_anim2:"char_anim2.png",char_anim3:"char_anim3.png",card_gold:"card_gold.png",card_red:"card_red.png",card_orange:"card_orange.png",title_bg:"title_bg2.jpg",anim_bg:"anim_bg.jpg",white_block:"white_block.png",white_bg:"white_bg.jpg",result_frame:"result_frame.png",confirm_dialog:"confirm_dialog.png"};for(var a in i)this.load.image(a,t+i[a]);for(var a in __itemList)this.load.image("item_"+__itemList[a],t+"items/"+__itemList[a]+".png");for(var a in i={closeBtn:"closeBtn.png"})this.load.image(a,"https://ap-statics.loas.jp/mm2/official/images/minigame/"+i[a])},loadedAssets:function(){document.body.style.cursor="pointer",this.state.start("Title")}},BasicGame.Title=function(){},BasicGame.Title.prototype={init:function(){this.curHistoryPage=0,this.maxHistoryPage=0,this.isOpenModal=!1},create:function(){this.add.sprite(0,0,"title_bg"),this.genBtns(),this.genConfirmModal(),this.genDetail(),this.genDetailModal()},genBtns:function(){this.add.sprite(.2*this.world.width,.7*this.world.height,"caption1").anchor.setTo(.5),this.add.sprite(.8*this.world.width,.7*this.world.height,"caption2").anchor.setTo(.5),this.add.sprite(.42*this.world.width,.52*this.world.height,"caption3").anchor.setTo(.5);var t=.8*this.world.height,i=[{x:.25*this.world.width,y:t,imgOff:"free_btn_off",imgOn:"free_btn_on"},{x:.5*this.world.width,y:t,imgOff:"play1_btn_off",imgOn:"play1_btn_on"},{x:.75*this.world.width,y:t,imgOff:"play10_btn_off",imgOn:"play10_btn_on"},{x:this.world.centerX,y:.6*this.world.height,imgOff:"play_blue_dia_10_btn_off",imgOn:"play_blue_dia_10_btn_on"},{x:.5*this.world.width,y:t+50,imgOff:"gacha_btn_1_off",imgOn:"gacha_btn_1_on"},{x:.75*this.world.width,y:t+50,imgOff:"gacha_btn_2_off",imgOn:"gacha_btn_2_on"}],a=0;for(var e in __gachaInfo){var n=__gachaInfo[e],s=i[a];this.genPlayBtn(e,n,s),a++}this.add.button(.92*this.world.width,.85*this.world.height,"detail_btn",this.openDetail,this).anchor.setTo(.5),this.add.text(.55*this.world.width,t+50,__data.haveTicket,genTextStyle()).anchor.setTo(0,.5),this.add.text(.8*this.world.width,t+50,__data.haveTicket,genTextStyle()).anchor.setTo(0,.5)},genPlayBtn:function(t,i,a){var e=this.add.button(a.x,a.y,a.imgOff,this.openConfirm,this);e.anchor.setTo(.5),1==i.specialPlayA&&0==__data.specialPlayCreditA||1==i.specialPlayB&&0==__data.specialPlayCreditB?(e.inputEnabled=!1,e.alpha=.5):(e.imgOn=a.imgOn,e.imgOff=a.imgOff,e.onInputDown.add(this.btnImgOn,this),e.onInputOver.add(this.btnImgOn,this),e.onInputOut.add(this.btnImgOff,this),e.onInputUp.add(this.btnImgOff,this),e.gachaId=t)},btnImgOn:function(t){this.isOpenModal||t.loadTexture(t.imgOn)},btnImgOff:function(t){this.isOpenModal||t.loadTexture(t.imgOff)},genConfirmModal:function(){this.ConfirmModal=this.add.group(),this.ConfirmModal.visible=!1;var t=this.add.sprite(this.world.centerX,this.world.centerY,"confirm_dialog");t.anchor.setTo(.5),t.width*=1.2,this.ConfirmText=this.add.text(this.world.centerX,this.world.centerY,"",genTextStyle()),this.ConfirmText.anchor.setTo(.5);var i=.65*this.world.height,a=this.add.button(.6*this.world.width,i,"ok_btn",this.playGacha,this);a.anchor.setTo(.5);var e=this.add.button(.4*this.world.width,i,"cancel_btn",this.closeConfirm,this);e.anchor.setTo(.5),this.ConfirmModal.add(t),this.ConfirmModal.add(a),this.ConfirmModal.add(e),this.ConfirmModal.add(this.ConfirmText)},openConfirm:function(t){this.isOpenModal||(this.isOpenModal=!0,this.ConfirmModal.visible=!0,__data.curGachaId=t.gachaId,__data.curGachaInfo=__gachaInfo[t.gachaId],this.ConfirmText.setText(genConfirmText()))},closeConfirm:function(){this.isOpenModal&&(this.isOpenModal=!1,this.ConfirmModal.visible=!1)},genHistoryModal:function(){this.HistoryModal=this.add.group(),this.HistoryModal.visible=!1;var t=this.add.sprite(this.world.centerX,this.world.centerY,"confirm_dialog");t.anchor.setTo(.5);var i=this.add.button(t.right,t.top,"closeBtn",this.closeHistory,this);this.PrevBtn=this.add.button(t.left,t.bottom,"closeBtn",this.prevHistory,this),this.PrevBtn.visible=!1,this.NextBtn=this.add.button(t.right,t.bottom,"closeBtn",this.nextHistory,this),this.NextBtn.visible=!1,this.HistoryText=this.add.text(this.world.centerX,this.world.centerY,"",{tabs:[.4*this.world.width,.4*this.world.width]}),this.HistoryText.anchor.setTo(.5),this.HistoryModal.add(t),this.HistoryModal.add(i),this.HistoryModal.add(this.PrevBtn),this.HistoryModal.add(this.NextBtn),this.HistoryModal.add(this.HistoryText)},genDetailModal:function(){this.DetailModal=this.add.group(),this.DetailModal.visible=!1;var t=this.add.sprite(this.world.centerX,this.world.centerY,"confirm_dialog");t.anchor.setTo(.5),t.scale.setTo(1.6);var i=this.add.button(t.right,t.top,"closeBtn",this.closeDetail,this);i.anchor.setTo(.5),i.scale.setTo(.6),this.DetailModal.add(t),this.DetailModal.add(i)},openDetail:function(){this.isOpenModal||(this.isOpenModal=!0,this.DetailModal.visible=!0,$(".minigame_detail_area").show())},closeDetail:function(){this.isOpenModal&&(this.isOpenModal=!1,this.DetailModal.visible=!1,$(".minigame_detail_area").hide())},genDetail:function(){var t="";for(var i in __itemInfo1){1==(a=__itemInfo1[i]).u?t+="<tr><td>"+a.r+"</td><td>"+a.n+'<span class="right_float"> 出現率UP！</span></td><td><span>'+a.p.toFixed(4)+"%</span></td></tr>":t+="<tr><td>"+a.r+"</td><td>"+a.n+"</td><td>"+a.p.toFixed(4)+"%</td></tr>"}for(var i in $(".detail_table_body_1").append(t),t="",__itemInfo2){var a;1==(a=__itemInfo2[i]).u?t+="<tr><td>"+a.r+"</td><td>"+a.n+'<span class="right_float">出現率UP！</span></td><td><span>'+a.p.toFixed(4)+"%</span></td></tr>":t+="<tr><td>"+a.r+"</td><td>"+a.n+"</td><td>"+a.p.toFixed(4)+"%</td></tr>"}$(".detail_table_body_2").append(t);var e=$(".minigame_detail_contents");$(".detail_item_btn").click(function(){var t=$(this).data("btn-num");e.children().hide(),$(".detail_content_"+t).show()})},playGacha:function(){this.state.start("Play")}},BasicGame.Play=function(){},BasicGame.Play.prototype={init:function(){this.movingCards=!1,this.skipInput=null,this.isOpenModal=!1,this.cardsArr=[],this.cardTweenArr=[],this.cardPosArr=[],this.flipingCardNum=0},create:function(){this.genFirstView(),this.genResultPanel(),this.genResultHUD(),this.genConfirmModal()},genFirstView:function(){this.time.events.add(300,function(){this.input.onDown.addOnce(this.play,this)},this),this.add.sprite(0,0,"anim_bg"),this.genEmitter(),this.CharAnim=this.add.sprite(0,0,"char_anim1"),this.Sword=this.add.sprite(this.world.centerX,this.world.centerY,"sword1"),this.Sword.anchor.setTo(.5)},genEmitter:function(){var t=this.add.emitter(this.world.centerX,this.world.centerY,200);t.makeParticles("white_block"),t.minParticleScale=.3,t.maxParticleScale=.6,t.gravity.x=0,t.gravity.y=0,t.setAlpha(1,0,12e3),t.setXSpeed(-300,300),t.setYSpeed(-80,80),t.start(!1,12e3,100,0),this.time.events.add(1e3,function(){this.setXSpeed(-100,100)},t)},genResultPanel:function(){this.ResultPanel=this.add.group(),this.ResultPanel.visible=!1;var t=this.add.sprite(this.world.centerX,this.world.centerY,"result_frame");t.anchor.setTo(.5),this.ResultPanel.add(t)},genResultHUD:function(){this.ResultHUD=this.add.group(),this.ResultHUD.visible=!1;var t=this.add.sprite(this.world.centerX,.95*this.world.height,"caution1");t.anchor.setTo(.5,1);var i=this.add.button(.3*this.world.width,.8*this.world.height,"back_btn_off",this.back,this);i.imgOn="back_btn_on",i.imgOff="back_btn_off",i.anchor.setTo(.5),this.setOnOffImg(i),this.AgainBtn=this.add.button(.7*this.world.width,.8*this.world.height,"again_btn_off",this.openConfirm,this),this.AgainBtn.imgOn="again_btn_on",this.AgainBtn.imgOff="again_btn_off",this.AgainBtn.anchor.setTo(.5),this.setOnOffImg(this.AgainBtn),this.ResultHUD.add(t),this.ResultHUD.add(i),this.ResultHUD.add(this.AgainBtn)},setOnOffImg:function(t){t.onInputDown.add(this.btnImgOn,this),t.onInputOver.add(this.btnImgOn,this),t.onInputOut.add(this.btnImgOff,this),t.onInputUp.add(this.btnImgOff,this)},btnImgOn:function(t){this.isOpenModal||t.loadTexture(t.imgOn)},btnImgOff:function(t){this.isOpenModal||t.loadTexture(t.imgOff)},genConfirmModal:function(){this.ConfirmModal=this.add.group(),this.ConfirmModal.visible=!1;var t=this.add.sprite(this.world.centerX,this.world.centerY,"confirm_dialog");t.anchor.setTo(.5),t.width*=1.2,this.ConfirmText=this.add.text(this.world.centerX,this.world.centerY,"",genTextStyle()),this.ConfirmText.anchor.setTo(.5);var i=.65*this.world.height,a=this.add.button(.6*this.world.width,i,"ok_btn",this.again,this);a.anchor.setTo(.5);var e=this.add.button(.4*this.world.width,i,"cancel_btn",this.closeConfirm,this);e.anchor.setTo(.5),this.ConfirmModal.add(t),this.ConfirmModal.add(a),this.ConfirmModal.add(e),this.ConfirmModal.add(this.ConfirmText)},play:function(){var i=this;$.ajax({method:"POST",url:"/minigame/gacha/play",data:{uId:__data.uId,sId:__data.sId,gachaId:__data.curGachaId},type:"json",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},timeout:5e3}).done(function(t){t.status&&0==t.code?(__data.getCardList=t.getCardList,__data.haveTicket=t.haveTicket,i.anim()):error(i,t.code)})},anim:function(){this.time.events.add(400,function(){this.CharAnim.loadTexture("char_anim2"),this.time.events.add(400,function(){this.CharAnim.loadTexture("char_anim3"),this.time.events.add(800,function(){this.CharAnim.loadTexture("char_anim2"),this.time.events.add(400,function(){this.CharAnim.loadTexture("char_anim1"),this.time.events.add(500,function(){this.moveCards()},this)},this)},this)},this)},this);var t=this.add.tween(this.Sword).to({y:-this.world.centerY},800,null,!0);t.onComplete.add(function(t){t.scale.y*=-1;var i="sword1";for(var a in __data.getCardList){var e=__data.getCardList[a];if("GR"==e.rare){i="sword2";break}"UR"==e.rare&&(i="sword3")}t.loadTexture(i)},this);var i=this.add.tween(this.Sword).to({y:1.5*this.world.height},800,null,!1,800);t.chain(i)},back:function(){this.isOpenModal||this.state.start("Title")},openConfirm:function(){this.isOpenModal||(this.isOpenModal=!0,this.ConfirmModal.visible=!0,this.ConfirmText.setText(genConfirmText()))},closeConfirm:function(){this.isOpenModal&&(this.isOpenModal=!1,this.ConfirmModal.visible=!1)},again:function(){this.state.start("Play")},moveCards:function(){this.movingCards=!0,this.ResultPanel.visible=!0;var t=this.ResultPanel.children[0],i=0,a=0;for(var e in __data.getCardList){var n=__data.getCardList[e],s=a%5,o=t.left+50+80*s,r=t.top+50+70*i,d=this.add.sprite(o,1.5*this.world.height,"GR"==n.rare?"card_gold":"UR"==n.rare?"card_red":"card_orange");d.anchor.setTo(.5),d.num=a,d.rare=n.rare,d.itemImg="item_"+n.itemId,d.animImg=n.animImg;var h=this.add.tween(d);h.to({y:r},1e3,Phaser.Easing.Back.Out,!0,200*a),this.ResultPanel.add(d),this.cardsArr.push(d),this.cardTweenArr.push(h),this.cardPosArr.push({x:o,y:r}),4==s&&i++,a++}h.onComplete.add(this.moveCardsComplete,this),this.skipInput=this.input.onDown.addOnce(this.skipMoveCards,this)},skipMoveCards:function(){for(var t in this.cardsArr)if(this.cardTweenArr[t].isRunning){this.cardTweenArr[t].stop();var i=this.cardsArr[t],a=this.cardPosArr[t];i.x=a.x,i.y=a.y}this.moveCardsComplete()},moveCardsComplete:function(){this.movingCards&&(this.movingCards=!1,this.skipInput.active=!1,this.flipCard())},flipCard:function(){if(this.flipingCardNum==__data.curGachaInfo.playGachaCount)return this.flipComplete();var t=this.cardsArr[this.flipingCardNum],i=this.add.tween(t.scale);i.to({x:0},100,null,!0,0),i.onComplete.add(function(){this.loadTexture(this.itemImg)},t);var a=this.add.tween(t.scale);a.to({x:1},100,null,!1,0),i.chain(a),this.flipingCardNum++,"GR"==t.rare&&t.animImg?(this.curGRAnim=t.animImg,"gr_char_7"==this.curGRAnim?a.onComplete.add(this.rareOpenAnimation2,this):a.onComplete.add(this.rareOpenAnimation,this)):a.onComplete.add(this.flipCard,this)},rareOpenAnimation:function(){this.RareSceneSprite=this.add.sprite(this.world.centerX,this.world.centerY,this.curGRAnim),this.RareSceneSprite.anchor.setTo(.5),this.RareSceneSprite.scale.setTo(1.5),this.add.tween(this.RareSceneSprite.scale).to({x:1,y:1},1e3,Phaser.Easing.Circular.Out,!0,300).onComplete.add(function(){this.time.events.add(1500,function(){this.RareSceneSprite.destroy(),this.flipCard()},this)},this);var t=this.add.sprite(0,0,"white_bg");t.width=this.world.width,t.height=this.world.height,this.add.tween(t).to({alpha:0},1e3,null,!0,100).onComplete.add(function(t){t.destroy()})},rareOpenAnimation2:function(){this.WhiteBgS=this.add.sprite(0,0,"white_bg"),this.WhiteBgS.width=this.world.width,this.WhiteBgS.height=this.world.height,this.RareScreneTS=this.add.sprite(this.world.centerX,this.world.centerY,this.curGRAnim+"_2"),this.RareScreneTS.anchor.setTo(.5),this.RareScreneTS.alpha=.5,this.add.tween(this.RareScreneTS).to({alpha:1},500,null,!0,100).onComplete.add(function(t){this.RareSceneSprite=this.add.sprite(this.world.centerX,this.world.centerY,this.curGRAnim),this.RareSceneSprite.anchor.setTo(.5),this.RareSceneSprite.scale.setTo(1.5),this.RareSceneSprite.visible=!1,this.add.tween(this.RareSceneSprite.scale).to({x:1,y:1},1e3,Phaser.Easing.Circular.Out,!0,600).onComplete.add(function(){this.time.events.add(1500,function(){this.RareSceneSprite.destroy(),this.RareScreneTS.destroy(),this.flipCard()},this)},this);var i=this.add.tween(this.WhiteBgS).to({alpha:0},1e3,null,!0,300);i.onStart.add(function(){this.RareSceneSprite.visible=!0},this),i.onComplete.add(function(t){t.destroy()}),this.world.bringToTop(this.RareScreneTS)},this)},flipComplete:function(){this.ResultHUD.visible=!0,1001==__data.curGachaId&&(__data.specialPlayCreditA=0,this.AgainBtn.visible=!1),1004==__data.curGachaId&&(__data.specialPlayCreditB=0,this.AgainBtn.visible=!1)}};