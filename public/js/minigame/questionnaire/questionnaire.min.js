BasicGame={},BasicGame.Boot=function(){},BasicGame.Boot.prototype={init:function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.stage.backgroundColor="#424242",this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.parentIsWindow=!0,this.scale.refresh()},preload:function(){this.load.crossOrigin="Anonymous",this.load.atlasJSONHash("loading","//ap-statics.loas.jp/mm2/official/images/minigame/loading.png","images/minigame/loading.json")},create:function(){this.defineGlobal(),this.defineConst(),this.defineConf(),this.state.start("Preloader")},defineGlobal:function(){this.game.global={serverInfo:null,serverId:null,itemId:null,userPoint:0,errNum:0}},defineConst:function(){this.game.const={SUCCESS:0,NETWORK_ERROR:-3,DB_ERROR:-7,REQUEST_ERROR:-8,CLOSED_GAME:-10,NOT_ENOUGHT_BALANCE:-5,SYSTEM_ERROR:-2,UNKNOWN:-999}},defineConf:function(){this.game.conf={payIds:{CoinBtn:"96a9519b8fddd17e8cc4bba0408ffffd",PointBtn:"78ee54aa8f813885fe2fe20d232518b9"},items:{2301:{count:1,img:"01.png",name:"女神の赤印"},2302:{count:20,img:"02.png",name:"レーヴラムール(欠片)"},2303:{count:1,img:"03.png",name:"不朽の宝箱(極小)"},2304:{count:5,img:"04.png",name:"星のインゴット幸運宝箱"},2305:{count:5,img:"05.png",name:"生命の葉幸運宝箱"},2306:{count:5,img:"06.png",name:"宝具刻印石幸運宝箱"},2307:{count:1,img:"07.png",name:"Goldナゲット(大)"},2308:{count:5,img:"08.png",name:"使い魔EXPポーション幸運宝箱"},2309:{count:1,img:"09.png",name:"星屑破片"},2310:{count:5,img:"10.png",name:"結晶石幸運宝箱"},2311:{count:20,img:"11.png",name:"チャチャ(欠片)"},2312:{count:10,img:"12.png",name:"龍魂の槍(欠片)"},2313:{count:1,img:"13.png",name:"使い魔の覚醒水晶"}}}}},BasicGame.Error=function(){},BasicGame.Error.prototype={create:function(){$(".textArea").hide(),this.stage.backgroundColor="#424242";var t=this.game.global.errNum,e=this.game.const;switch(t){case e.NETWORK_ERROR:this.genText("ネットワークエラーです。\n再度お試しください。");break;case e.DB_ERROR:this.genText("データベースエラーです。\n再度お試しください。");break;case e.REQUEST_ERROR:this.genText("リクエストエラーです。\n再度お試しください。");break;case e.CLOSED_GAME:this.genText("このゲームのキャンペーン期間は\nすでに終了しています。");break;case e.NOT_ENOUGHT_BALANCE:this.genText("残高不足です。\nご確認の上\n再度お試しください。");break;case e.SYSTEM_ERROR:this.genText("システムエラーです。\n再度お試しください。");break;default:this.genText("不明なエラーです。\n再度お試しください。")}this.input.onDown.add(function(){return window.location.href="/"},this)},genText:function(t){this.add.text(this.world.centerX,this.world.centerY,t,{font:"55px",fill:"#ffffff",stroke:"#000000",strokeThickness:20,align:"center"}).anchor.setTo(.5)}},BasicGame.Play=function(){},BasicGame.Play.prototype={init:function(){this.CanvasContainer=null,this.selectedBtnKey=null,this.dataURL=null,this.bgSprite=null,this.btnGroup=null,this.panelGroup=null},create:function(){this.bgSprite=this.genBackground(),this.genBtnContainer(),this.CanvasContainer=this.genCanvasContainer(),this.genPointTextSprite(),this.genTextArea()},genBackground:function(){var t=this.add.sprite(this.world.centerX,this.world.centerY,"PlayBG");return t.anchor.setTo(.5),t},genBtnContainer:function(){this.btnGroup=this.add.group(),this.genCoinBtn(),this.genPointBtn(),this.genBackBtn(),this.genResetBtn()},genCoinBtn:function(){var t=this.add.button(this.world.centerX/2,this.world.height-350,"CoinBtn",function(){this.genPanelContainer(t.key,function(){this.btnGroup.setAll("inputEnabled",!1),this.panelGroup.setAll("inputEnabled",!1),this.selectedBtnKey=t.key,this.play()})},this);t.anchor.setTo(.5),this.btnGroup.add(t)},genPointBtn:function(){var t=this.add.button(this.world.centerX/2*3,this.world.height-350,"PointBtn",function(){this.genPanelContainer(t.key,function(){this.btnGroup.setAll("inputEnabled",!1),this.panelGroup.setAll("inputEnabled",!1),this.selectedBtnKey=t.key,this.play()})},this);t.anchor.setTo(.5),this.btnGroup.add(t)},genBackBtn:function(){var t=this.add.button(this.world.centerX/2,this.world.height-100,"BackBtn",function(){this.genPanelContainer(t.key,function(){this.state.start("Title")})},this);t.anchor.setTo(.5),this.btnGroup.add(t)},genResetBtn:function(){var t=this.add.button(this.world.centerX/2*3,this.world.height-100,"ResetBtn",function(){this.genPanelContainer(t.key,function(){this.CanvasContainer.clear(),this.btnGroup.setAll("inputEnabled",!0),this.panelGroup.destroy()})},this);t.anchor.setTo(.5),this.btnGroup.add(t)},genPanelContainer:function(t,e){this.panelGroup=this.add.group(),this.btnGroup.setAll("inputEnabled",!1);var n="Panel_CP";"BackBtn"==t?n="Panel_MB":"ResetBtn"==t&&(n="Panel_R");var i=this.add.sprite(this.world.centerX,this.world.centerY+200,n);i.anchor.setTo(.5);var a=this.world.centerY+350,s=this.add.button(this.world.centerX-200,a,"YesBtn",e,this);s.anchor.setTo(.5);var o=this.add.button(this.world.centerX+200,a,"NoBtn",function(){this.btnGroup.setAll("inputEnabled",!0),this.panelGroup.destroy()},this);o.anchor.setTo(.5),this.panelGroup.add(i),this.panelGroup.add(s),this.panelGroup.add(o)},genCanvasContainer:function(){var t={},e=this.make.bitmapData(759,326);e.addToWorld(71,760),e.x=71,e.y=760;var n=this.make.bitmapData(759,326);return n.circle(32,32,5,"rgba(121,121,255,1)"),this.input.addMoveCallback(function(t,i,a){if(t.isDown){var s=i-71-32,o=a-760-32;e.draw(n,s,o)}},this),t.clear=function(){e.clear()},t.getPaper=function(){return e},t},genPointTextSprite:function(){var t=this.world.centerX+230,e=this.game.global.userPoint;this.add.text(t,135,e,{font:"35px",fill:"#ffffff",stroke:"#6c3a64",strokeThickness:15}).anchor.setTo(1)},genTextArea:function(){var t=$("#game"),e=$("canvas"),n=e.height()/4,i=t.width()/2-e.width()/4,a=$(".textArea");a.css({top:n,left:i}),a.show()},play:function(){var t=this.CanvasContainer.getPaper(),e=this.add.bitmapData(t.width,t.height);this.world.updateTransform(),e.copy(this.bgSprite,t.x,t.y),e.copy(this.CanvasContainer.getPaper());var n=this.make.renderTexture(e.width,e.height);n.render(e.addToWorld(this.world.width,this.world.height)),this.dataURL=n.getBase64();var i=this;this.fetchResult().then(function(t){i.game.global.itemId=t.itemId,i.state.start("Result")},function(t){i.errView(t)})},fetchResult:function(){var t=this.game.const;return $.ajax({method:"POST",url:"/minigame/questionnaire/play",data:{gId:__gId,sId:this.game.global.serverId,sendText:$("textArea").val(),dataURL:this.dataURL,payId:this.game.conf.payIds[this.selectedBtnKey]},type:"json",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},timeout:1e4}).then(function(e){return!1===e.status&&e.code==t.REQUEST_ERROR?$.Deferred().reject(t.REQUEST_ERROR).promise():!1===e.status&&e.code==t.DB_ERROR?$.Deferred().reject(t.DB_ERROR).promise():!1===e.status&&e.code==t.CLOSED_GAME?$.Deferred().reject(t.CLOSED_GAME).promise():!1===e.status&&e.code==t.NOT_ENOUGHT_BALANCE?$.Deferred().reject(t.NOT_ENOUGHT_BALANCE).promise():!0===e.status&&e.code==t.SUCCESS?$.Deferred().resolve(e).promise():$.Deferred().reject(t.UNKNOWN).promise()}).fail(function(){return $.Deferred().reject(t.NETWORK_ERROR).promise()})},errView:function(t){this.game.global.errNum=t,this.state.start("Error")}},BasicGame.Preloader=function(){},BasicGame.Preloader.prototype={preload:function(){this.loadingAnim(),this.loadAssets()},create:function(){var t=this;this.fetchServerInfo().then(function(e){return t.game.global.serverInfo=e.serverInfo,t.fetchUP()}).then(function(e){return t.game.global.userPoint=e.up,t.state.start("Title")},function(e){t.errView(e)})},loadingAnim:function(){var t=this.add.sprite(this.world.centerX,this.world.centerY,"loading");t.anchor.setTo(.5),t.animations.add("loading").play(8,!0)},loadAssets:function(){var t="//ap-statics.loas.jp/mm2/official/images/minigame/questionnaire/";this.load.image("StartBtn",t+"StartBtn.png"),this.load.image("ItemListBtn",t+"ItemListBtn.png"),this.load.image("HowToBtn",t+"HowToBtn.png"),this.load.image("CloseBtn",t+"CloseBtn.png"),this.load.image("YesBtn",t+"YesBtn.png"),this.load.image("NoBtn",t+"NoBtn.png"),this.load.image("CoinBtn",t+"CoinBtn.png"),this.load.image("PointBtn",t+"PointBtn.png"),this.load.image("BackBtn",t+"BackBtn.png"),this.load.image("ResetBtn",t+"ResetBtn.png"),this.load.image("MainBackBtn",t+"MainBackBtn.png"),this.load.image("TweetBtn",t+"TweetBtn.png"),this.load.image("Panel_CP",t+"Panel_CP.png"),this.load.image("Panel_MB",t+"Panel_MB.png"),this.load.image("Panel_R",t+"Panel_R.png"),this.load.image("TitleBG",t+"title.jpg"),this.load.image("HowToPanel",t+"howto.jpg"),this.load.image("ItemListPanel",t+"itemlist.jpg"),this.load.image("PlayBG",t+"write.jpg"),this.load.image("ResultBG",t+"result.jpg");var e=this.game.conf.items;for(var n in e)this.load.image(n,t+e[n].img)},fetchServerInfo:function(){var t=this.game.const;return $.ajax({method:"POST",url:"/minigame/fetchSList",data:{gId:__gId},type:"json",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},timeout:12e3}).then(function(e){return!1===e.status&&e.code==t.REQUEST_ERROR?$.Deferred().reject(t.REQUEST_ERROR).promise():!0===e.status&&e.code==t.SUCCESS?$.Deferred().resolve(e.data).promise():$.Deferred().reject(t.UNKNOWN).promise()}).fail(function(){return $.Deferred().reject(t.NETWORK_ERROR).promise()})},fetchUP:function(){var t=this.game.const;return $.ajax({method:"POST",url:"/minigame/fetchUP",data:{gId:__gId},type:"json",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},timeout:5e3}).then(function(e){return!0===e.status&&e.code==t.SUCCESS?$.Deferred().resolve(e).promise():$.Deferred().reject(t.UNKNOWN).promise()}).fail(function(){return $.Deferred().reject(t.NETWORK_ERROR).promise()})},errView:function(t){this.game.global.errNum=t,this.state.start("Error")}},BasicGame.Result=function(){},BasicGame.Result.prototype={init:function(){this.btnGroup=null,this.panelGroup=null},create:function(){this.genBackground(),this.genBtnContainer(),this.genGiveItemSprite(),$(".textArea").hide()},genBackground:function(){this.add.sprite(this.world.centerX,this.world.centerY,"ResultBG").anchor.setTo(.5)},genBtnContainer:function(){this.btnGroup=this.add.group(),this.genBackBtn(),this.genTweetBtn()},genBackBtn:function(){var t=this.add.button(this.world.centerX,this.world.height-350,"MainBackBtn",function(){this.genPanelContainer(t.key,function(){this.state.start("Title")})},this);t.anchor.setTo(.5),this.btnGroup.add(t)},genTweetBtn:function(){var t=this.add.button(this.world.width/4*3,this.world.height-100,"TweetBtn",function(){var t=this.game.conf.items[this.game.global.itemId],e="#リーグ・オブ・エンジェルズ 公式限定ミニゲーム【神社祈願】で"+t.name+" "+t.count+"個を手に入れました！",n=encodeURIComponent(e),i=location.href;return window.open("https://twitter.com/intent/tweet?text="+n+"&url="+i+"&hashtags=LOA_JP","share window","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600"),!1},this);t.anchor.setTo(.5),this.btnGroup.add(t)},genGiveItemSprite:function(){var t=this.game.global.itemId,e=this.game.conf.items,n=e[t].count,i=e[t].name,a=this.add.sprite(this.world.centerX,this.world.height/4+100,t);a.anchor.setTo(.5),a.scale.setTo(5);var s={font:"35px",fill:"#ffffff",stroke:"#6c3a64",strokeThickness:15};this.add.text(a.right-20,a.bottom,n,s).anchor.setTo(1);this.add.text(this.world.centerX,a.bottom+50,i,s).anchor.setTo(.5)},genPanelContainer:function(t,e){this.panelGroup=this.add.group(),this.btnGroup.setAll("inputEnabled",!1);var n=this.add.sprite(this.world.centerX,this.world.centerY+200,"Panel_MB");n.anchor.setTo(.5);var i=this.world.centerY+350,a=this.add.button(this.world.centerX-200,i,"YesBtn",e,this);a.anchor.setTo(.5);var s=this.add.button(this.world.centerX+200,i,"NoBtn",function(){this.btnGroup.setAll("inputEnabled",!0),this.panelGroup.destroy()},this);s.anchor.setTo(.5),this.panelGroup.add(n),this.panelGroup.add(a),this.panelGroup.add(s)}},BasicGame.Title=function(){},BasicGame.Title.prototype={init:function(){this.PanelContainer=null},create:function(){this.genBackground(),this.genServerList(),this.genBtnContainer(),this.PanelContainer=this.genPanelContainer(),$(".textArea").hide()},genBackground:function(){this.add.sprite(this.world.centerX,this.world.centerY,"TitleBG").anchor.setTo(.5)},genServerList:function(){var t=this;__selectServer=function(e){layer.closeAll(),t.game.global.serverId=e};var e='<div class="server_area"><div class="server_list_title"></div><div class="server_area_items">',n=this.game.global.serverInfo;for(var i in n)e+='<div class="server_item" onclick="__selectServer('+i+')">'+n[i].serverName+"<br>"+n[i].userName+"</div>";e+="</div></div>",layer.open({type:1,closeBtn:!1,title:!1,shadeClose:!1,skin:"layui-layer-nobg",shade:.8,area:["910px","610px"],content:e})},genBtnContainer:function(){this.genStartBtn(),this.genItemListBtn(),this.genHowToBtn()},genStartBtn:function(){this.add.button(this.world.centerX,this.world.height-350,"StartBtn",function(){this.state.start("Play")},this).anchor.setTo(.5)},genItemListBtn:function(){this.add.button(this.world.width/4,this.world.height-100,"ItemListBtn",function(){this.PanelContainer.show("ItemListPanel")},this).anchor.setTo(.5)},genHowToBtn:function(){this.add.button(this.world.width/4*3,this.world.height-100,"HowToBtn",function(){this.PanelContainer.show("HowToPanel")},this).anchor.setTo(.5)},genPanelContainer:function(){var t={},e=this.genItemListPanel(),n=this.genHowToPanel(),i=this.genCloseBtn();return t.show=function(t){this.hide();var a=null;"ItemListPanel"==t?a=e:"HowToPanel"==t&&(a=n),a&&(a.visible=!0,i.visible=!0,i.pos(a))},t.hide=function(){e.visible=!1,n.visible=!1,i.visible=!1},t.hide(),t},genItemListPanel:function(){var t=this.add.sprite(this.world.centerX,this.world.centerY,"ItemListPanel");return t.anchor.setTo(.5),t},genHowToPanel:function(){var t=this.add.sprite(this.world.centerX,this.world.centerY,"HowToPanel");return t.anchor.setTo(.5),t},genCloseBtn:function(){var t=this.add.button(0,0,"CloseBtn",function(){this.PanelContainer.hide()},this);return t.anchor.setTo(.5),t.pos=function(e){t.x=e.right-60,t.y=e.top+60},t}};